# Generated by Django 4.2.9 on 2024-04-06 17:18
from django.contrib.contenttypes.models import ContentType
from django.db import migrations


def replace_menu_items(apps, schema_editor):
    MenuItem = apps.get_model("core", "MenuItem")
    menu_item_content_type = ContentType.objects.get_for_model(MenuItem)
    FirstLevelMenuItem = apps.get_model("core", "FirstLevelMenuItem")
    SecondLevelMenuItem = apps.get_model("core", "SecondLevelMenuItem")
    for menu_item_data in FirstLevelMenuItem.objects.values():
        menu_item = FirstLevelMenuItem.objects.get(id=menu_item_data["id"])
        visible_for = list(menu_item.visible_for.all())
        menu_item.delete()
        menu_item_data["content_type_id"] = menu_item_content_type.id
        new_menu_item = MenuItem.objects.create(**menu_item_data)
        new_menu_item.visible_for = visible_for
        new_menu_item.save()
    for menu_item_data in SecondLevelMenuItem.objects.values():
        menu_item = SecondLevelMenuItem.objects.get(id=menu_item_data["id"])
        visible_for = list(menu_item.visible_for.all())
        menu_item.delete()
        menu_item_data["content_type_id"] = menu_item_content_type.id
        new_menu_item = MenuItem.objects.create(**menu_item_data)
        new_menu_item.visible_for = visible_for
        new_menu_item.save()


class Migration(migrations.Migration):

    dependencies = [
        ("core", "0012_menuitem"),
    ]

    operations = [
        migrations.RunPython(replace_menu_items),
    ]
